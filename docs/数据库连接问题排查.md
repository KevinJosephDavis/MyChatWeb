启动服务器时出现错误：

```bash
kevin@kevin-virtual-machine:~/goproject/chatroom/backend$ go run ./cmd/api-server
HTTP服务器在8080端口监听...
2025/10/31 09:12:41 数据库连接失败，错误信息：Error 1045 (28000): Access denied for user 'username'@'localhost' (using password: YES)
exit status 1
```

根据错误信息，似乎是某个地方的dsn中用户名与密码不匹配，开始排查。

先检查config.go

```go
package config

import (
	"os"

	"github.com/joho/godotenv"
)

type Config struct {
	MySQLDSN      string
	RedisAddr     string
	RedisPassword string
	RedisDB       int
}

func LoadConfig() *Config {
	//加载 .env 文件
	godotenv.Load()

	return &Config{
		MySQLDSN:      getEnv("MYSQL_DSN", "root:123456@tcp(localhost:3306)/chatroom?charset=utf8mb4&parseTime=True&loc=Local"),
		RedisAddr:     getEnv("REDIS_ADDR", "localhost:6379"),
		RedisPassword: getEnv("REDIS_PASSWORD", ""),
		RedisDB:       0,
	}
}

func getEnv(key, defaultValue string) string {
	if value := os.Getenv(key); value != "" {
		return value
	}
	return defaultValue
}

```

没什么问题

检查mysql.go

```go
// 封装mysql数据库相关操作
package database

import (
	"fmt"
	"log"
	"time"

	"gorm.io/driver/mysql"
	"gorm.io/gorm"
	"gorm.io/gorm/logger"

	"github.com/kevinjosephdavis/chatroom/internal/config"
	"github.com/kevinjosephdavis/chatroom/internal/repository/model"
)

var MySQL *gorm.DB

func InitMySQL(cfg *config.Config) error {
	var err error

	//连接 MySQL
	MySQL, err = gorm.Open(mysql.Open(cfg.MySQLDSN), &gorm.Config{
		Logger: logger.Default.LogMode(logger.Info),
	})
	if err != nil {
		return fmt.Errorf("连接MySQL失败: %v", err)
	}

	sqlDB, err := MySQL.DB()
	if err != nil {
		return err
	}

	//设置连接池
	sqlDB.SetMaxIdleConns(10)
	sqlDB.SetMaxOpenConns(100)
	sqlDB.SetConnMaxLifetime(time.Hour)

	//自动迁移表结构
	if err := autoMigrate(); err != nil {
		return fmt.Errorf("自动迁移失败: %v", err)
	}

	log.Println("MySQL 连接成功")
	return nil
}

func autoMigrate() error {
	return MySQL.AutoMigrate(
		&model.User{},
		&model.Friend{},
		//&model.Group{},
		//&model.GroupMember{},
		//&model.Message{},
	)
}

func GetMySQL() *gorm.DB {
	return MySQL
}

```

使用的是config.go中的dsn，没什么问题

检查一下startHTTPServer函数中初始化数据库的操作：

```go
dsn := "username:123456@tcp(localhost:3306)/chatroom?charset=utf8mb4&parseTime=True&loc=Local"
	db, err := gorm.Open(mysql.Open(dsn), &gorm.Config{})
	if err != nil {
		log.Fatal("数据库连接失败，错误信息：", err)
		return
	}
```

把username改成root，再运行试试看：

```bash
kevin@kevin-virtual-machine:~/goproject/chatroom/backend$ go run ./cmd/api-server
HTTP服务器在8080端口监听...
[GIN-debug] [WARNING] Creating an Engine instance with the Logger and Recovery middleware already attached.

[GIN-debug] [WARNING] Running in "debug" mode. Switch to "release" mode in production.
 - using env:	export GIN_MODE=release
 - using code:	gin.SetMode(gin.ReleaseMode)

[GIN-debug] POST   /api/register             --> github.com/kevinjosephdavis/chatroom/internal/controller.(*UserController).Register-fm (3 handlers)
[GIN-debug] POST   /api/login                --> github.com/kevinjosephdavis/chatroom/internal/controller.(*UserController).Login-fm (3 handlers)
[GIN-debug] GET    /ping                     --> main.startHTTPServer.func1 (3 handlers)
[GIN-debug] [WARNING] You trusted all proxies, this is NOT safe. We recommend you to set a value.
Please check https://github.com/gin-gonic/gin/blob/master/docs/doc.md#dont-trust-all-proxies for details.
[GIN-debug] Listening and serving HTTP on :8080

```

数据库连接问题已经解决